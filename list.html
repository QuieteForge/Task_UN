<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LISTï½œã‚¿ã‚¹ã‚¯</title>
  <style>
    :root{
      --bg:#f7f7f8; --card:#fff; --ink:#111; --sub:#666; --line:#e9e9ec;
      --pill:#eef2ff; --accent:#3957ff; --ok:#16a34a; --warn:#eab308; --danger:#ef4444;
    }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{ margin:0; background:var(--bg); color:var(--ink);
      font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial }
    header{ position:sticky; top:0; background:var(--card); border-bottom:1px solid var(--line); z-index:10 }
    .bar{ display:flex; align-items:center; justify-content:space-between; padding:12px 16px }
    .title{ font-weight:650; letter-spacing:.2px }
    .pill{ padding:6px 10px; border-radius:999px; background:var(--pill); font-size:12px }

    main{ padding:14px; max-width:720px; margin:0 auto }
    .section{ margin:18px 0 }
    .section h3{ margin:8px 6px 10px; font-size:13px; color:var(--sub); font-weight:600 }

    .card{
      position:relative; background:var(--card); border:1px solid var(--line);
      border-radius:16px; margin:10px 0; box-shadow:0 1px 0 rgba(0,0,0,.03);
      overflow:hidden;
    }

    /* Top row (click to expand) */
    .row{
      display:flex; align-items:center; gap:8px; padding:12px 14px;
    }
    .titleTxt{ flex:1; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .pin{ font-size:12px; color:var(--accent) }
    .meta{ display:flex; gap:8px; color:var(--sub); font-size:12px }
    .pillDue{ padding:2px 8px; border-radius:999px; border:1px solid var(--line) }
    .ghost{ opacity:.45 }

    /* Swipe track */
    .swipe-wrap{ position:relative; overflow:hidden }
    .track{ position:relative; touch-action:pan-y; background:var(--card) }
    .actions{
      position:absolute; inset:0; display:flex; justify-content:space-between; align-items:center;
      padding:0 8px; pointer-events:none;
    }
    .btn{ pointer-events:auto; padding:8px 10px; border-radius:10px; border:1px solid var(--line);
      background:#fff; font-size:12px; }
    .btn.ok{ color:var(--ok); background:#ecfdf5; border-color:#c7ecd1 }
    .btn.warn{ color:var(--warn); background:#fffbeb; border-color:#fde68a }
    .btn.danger{ color:var(--danger); background:#fef2f2; border-color:#fecaca }

    /* Detail panel */
    .panel{
      padding:12px 14px; border-top:1px dashed var(--line); background:#fff; display:none;
    }
    .panel.open{ display:block }
    .grid{ display:grid; grid-template-columns:120px 1fr; gap:10px; align-items:center; margin:8px 0 }
    .grid label{ color:var(--sub); font-size:13px }
    input[type="text"],textarea,input[type="datetime-local"],input[type="number"]{
      width:100%; padding:10px 12px; border:1px solid var(--line); border-radius:12px; background:#fff; font:inherit;
    }
    textarea{ min-height:84px; resize:vertical }
    .switch{ display:flex; align-items:center; gap:8px }
    .panelBtns{ display:flex; flex-wrap:wrap; gap:8px; margin-top:8px }
    .b{ padding:10px 14px; border-radius:12px; border:1px solid var(--line); background:#fff; cursor:pointer }
    .b.primary{ background:#111; color:#fff; border-color:#111 }
    .b.ok{ color:var(--ok); background:#ecfdf5; border-color:#c7ecd1 }
    .b.warn{ color:var(--warn); background:#fffbeb; border-color:#fde68a }
    .b.danger{ color:var(--danger); background:#fef2f2; border-color:#fecaca }

    .empty{ color:var(--sub); text-align:center; padding:36px 12px }

    .toast{ position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:#111; color:#fff; padding:10px 14px; border-radius:999px; font-size:13px; opacity:0; transition:.25s }
    .toast.show{ opacity:1 }

    /* snap hint (optional) */
    .snapHint{
      position:absolute; top:50%; transform:translateY(-50%);
      width:120px; text-align:center; font-size:11px; color:#888; opacity:.0; transition:.2s;
    }
    .snapHint.left{ left:8px } .snapHint.right{ right:8px }
    .showHint .snapHint{ opacity:.9 }
  </style>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <header>
    <div class="bar">
      <div class="title">LISTï½œã‚¿ã‚¹ã‚¯</div>
      <div class="pill" id="user-pill">loadingâ€¦</div>
    </div>
  </header>

  <main>
    <div id="active" class="section">
      <h3>ğŸ“ æœªå®Œäº†</h3>
      <div id="active-list"></div>
    </div>

    <div id="completed" class="section" hidden>
      <h3>âœ… å®Œäº†ï¼ˆç›´è¿‘1é€±é–“ï¼‰</h3>
      <div id="completed-list"></div>
    </div>

    <div id="empty" class="empty" hidden>ã¾ã ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“ã€‚LINEã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹ã¨è¿½åŠ ã•ã‚Œã¾ã™ã€‚</div>

    <pre id="debug" style="white-space:pre-wrap;font:12px/1.4 ui-monospace,Menlo,Consolas,monospace;background:#fff;border:1px solid #eee;padding:8px;border-radius:8px"></pre>
  </main>

  <div id="toast" class="toast"></div>

<script>
/** ====== è¨­å®š ====== */
const LIFF_ID        = "2008311584-NdJqOqMn";
const LIST_API_URL   = "https://lumicreate.xvps.jp/webhook/webhook-list";
const ACTION_API_URL = "https://lumicreate.xvps.jp/webhook/webhook-action";
/** ================== */

let gUserId = null;
let gAllTasks = [];

const el = s => document.querySelector(s);
const $activeList = el('#active-list');
const $completedList = el('#completed-list');
const $completed = el('#completed');
const $empty = el('#empty');

function toast(m){ const t=el('#toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1400); }
function dbg(...a){ const d=el('#debug'); d.textContent+=a.map(x=>typeof x==='string'?x:JSON.stringify(x)).join(' ')+'\n'; d.scrollTop=d.scrollHeight; }

const fmtJST = iso => iso? new Date(iso).toLocaleString('ja-JP',{timeZone:'Asia/Tokyo',month:'numeric',day:'numeric',hour:'2-digit',minute:'2-digit'}):'';
function escapeHTML(s){ return String(s||'').replace(/[&<>"']/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c])) }
function toLocalInputValue(iso){ if(!iso) return ''; const d=new Date(iso); const z=new Date(d.getTime()-d.getTimezoneOffset()*60000); return z.toISOString().slice(0,16); }
function toUTCFromLocalInput(val){ if(!val) return null; const d=new Date(val); return new Date(d.getTime()-d.getTimezoneOffset()*60000).toISOString(); }

function sortTasks(arr){
  return arr.slice().sort((a,b)=>{
    const ad = new Date(a.due_at || 0).getTime();
    const bd = new Date(b.due_at || 0).getTime();
    if (ad !== bd) return ad - bd;
    const ap = Number.isFinite(a.priority) ? a.priority : -1;
    const bp = Number.isFinite(b.priority) ? b.priority : -1;
    return bp - ap;
  });
}
function splitByStatus(all){
  const now = Date.now(), weekAgo = now - 7*24*3600*1000;
  const active=[], completed=[];
  for(const t of all){
    if (t.status === 'completed'){
      const cAt = t.completed_at ? new Date(t.completed_at).getTime() : 0;
      if (cAt >= weekAgo) completed.push(t);
      continue;
    }
    if (t.status==='deleted' || t.status==='archived') continue;
    active.push(t);
  }
  return { active, completed };
}

async function runAction(action, extra={}){
  const body = { action, user_id:gUserId, ...extra };
  const res = await fetch(ACTION_API_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body) });
  const j = await res.json().catch(()=>({ok:false}));
  if(!res.ok || j.ok===false) throw new Error(j.message || 'action failed');
  return j;
}

async function loadTasks(){
  const url = `${LIST_API_URL}?user_id=${encodeURIComponent(gUserId)}`;
  const res = await fetch(url,{ headers:{'Content-Type':'application/json'} });
  const payload = await res.json();
  if(!payload?.ok){ toast('èª­ã¿è¾¼ã¿å¤±æ•—'); return; }
  const { pinned=[], active=[], completed=[] } = payload;
  gAllTasks = [...pinned, ...active, ...completed];
  render();
}

function cardHTML(t){
  const dueTxt = fmtJST(t.due_at);
  const pin = t.pinned ? '<span class="pin">ğŸ“Œ</span>' : '';
  const ghost = t.status === 'completed' ? ' ghost' : '';
  const id = t.id;
  return `
  <div class="card${ghost}" data-id="${id}">
    <div class="swipe-wrap">
      <div class="actions">
        <div class="snapHint left">æ“ä½œ</div>
        <div class="snapHint right">æ“ä½œ</div>
        <div style="display:flex;gap:6px">
          <button class="btn ok" data-act="complete">å®Œäº†</button>
          <button class="btn warn" data-act="remind">ï¾˜ï¾ï½²ï¾ï¾„ï¾</button>
        </div>
        <div style="display:flex;gap:6px">
          <button class="btn" data-act="pin">${t.pinned?'ãƒ”ãƒ³è§£é™¤':'ãƒ”ãƒ³'}</button>
          <button class="btn" data-act="detail">è©³ç´°</button>
          <button class="btn danger" data-act="delete">å‰Šé™¤</button>
        </div>
      </div>
      <div class="track">
        <div class="row titleRow">
          <div class="titleTxt">${pin}${escapeHTML(t.title||'(ç„¡é¡Œ)')}</div>
          <div class="meta"><span class="pillDue">â° ${escapeHTML(dueTxt)}</span>${Number.isFinite(t.priority)?`<span class="pillDue">â˜…${t.priority}</span>`:''}</div>
        </div>
      </div>
    </div>

    <div class="panel" id="p-${id}">
      <div class="grid"><label>ã‚¿ã‚¤ãƒˆãƒ«</label><input type="text" data-f="title" value="${escapeHTML(t.title||'')}" /></div>
      <div class="grid"><label>è©³ç´°</label><textarea data-f="detail">${escapeHTML(t.detail||'')}</textarea></div>
      <div class="grid"><label>æœŸé™</label><input type="datetime-local" data-f="due_at" value="${toLocalInputValue(t.due_at)}"/></div>
      <div class="grid"><label>å„ªå…ˆåº¦</label><input type="number" min="0" max="10" data-f="priority" value="${t.priority??''}"/></div>
      <div class="grid"><label>Vision</label><input type="number" min="0" max="10" data-f="vision_score" value="${t.vision_score??''}"/></div>
      <div class="grid"><label>Excite</label><input type="number" min="0" max="10" data-f="excite_score" value="${t.excite_score??''}"/></div>
      <div class="grid"><label>Growth</label><input type="number" min="0" max="10" data-f="growth_score" value="${t.growth_score??''}"/></div>
      <div class="grid"><label>ãƒ”ãƒ³ç•™ã‚</label><div class="switch"><input type="checkbox" data-f="pinned" ${t.pinned?'checked':''}/><span class="meta">ä¸€è¦§ä¸Šéƒ¨ã«è¡¨ç¤º</span></div></div>
      <div class="panelBtns">
        <button class="b primary" data-save>ä¿å­˜</button>
        <button class="b ok" data-complete ${t.status==='completed'?'disabled':''}>å®Œäº†</button>
        <button class="b warn" data-uncomplete ${t.status!=='completed'?'disabled':''}>å®Œäº†å–æ¶ˆã—</button>
        <button class="b" data-togglepin>${t.pinned?'ãƒ”ãƒ³è§£é™¤':'ãƒ”ãƒ³ç•™ã‚'}</button>
        <button class="b danger" data-delete>å‰Šé™¤</button>
      </div>
      <div class="meta">ä½œæˆ: ${fmtJST(t.created_at)} / æ›´æ–°: ${fmtJST(t.updated_at)}${t.completed_at?` / å®Œäº†: ${fmtJST(t.completed_at)}`:''}</div>
    </div>
  </div>`;
}

function render(){
  const {active, completed} = splitByStatus(gAllTasks);
  const actSorted = sortTasks(active);
  const compSorted = sortTasks(completed);

  $activeList.innerHTML    = actSorted.map(cardHTML).join('');
  $completedList.innerHTML = compSorted.map(cardHTML).join('');
  $completed.hidden = compSorted.length === 0;
  $empty.hidden     = actSorted.length > 0;

  // ã‚¯ãƒªãƒƒã‚¯ã§ãƒ‘ãƒãƒ«é–‹é–‰
  document.querySelectorAll('.card .titleRow').forEach(row=>{
    row.addEventListener('click', ()=>{
      const card = row.closest('.card');
      const id   = card.dataset.id;
      const pan  = el(`#p-${CSS.escape(id)}`);
      pan.classList.toggle('open');
    });
  });

  // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼ˆè©³ç´°ãƒœã‚¿ãƒ³ç¾¤ï¼‰
  document.querySelectorAll('.panel').forEach(p=>{
    const card = p.closest('.card'); const id = card.dataset.id;
    p.querySelector('[data-save]')?.addEventListener('click', ()=>saveCard(id,p));
    p.querySelector('[data-complete]')?.addEventListener('click', ()=>completeCard(id));
    p.querySelector('[data-uncomplete]')?.addEventListener('click', ()=>uncompleteCard(id));
    p.querySelector('[data-togglepin]')?.addEventListener('click', ()=>togglePin(id,p));
    p.querySelector('[data-delete]')?.addEventListener('click', ()=>deleteCard(id));
  });

  // ã‚¹ãƒ¯ã‚¤ãƒ—ï¼ˆãƒœã‚¿ãƒ³ãƒ»ã‚¹ãƒŠãƒƒãƒ—æœ‰ã‚Šï¼‰
  document.querySelectorAll('.swipe-wrap .track').forEach(bindSwipe);
}

/* ===== ã‚¹ãƒ¯ã‚¤ãƒ—ï¼šã‚¹ãƒŠãƒƒãƒ— â†’ ãƒœã‚¿ãƒ³æ“ä½œ or å¼·ã„ã‚¹ãƒ¯ã‚¤ãƒ—ã§å³å®Ÿè¡Œ ===== */
const SW_SNAP_L = 90;   // å·¦ã‚¹ãƒŠãƒƒãƒ—è·é›¢ï¼ˆã“ã“ã§åœæ­¢ï¼ãƒœã‚¿ãƒ³æ“ä½œå¯ï¼‰
const SW_SNAP_R = -90;  // å³ã‚¹ãƒŠãƒƒãƒ—è·é›¢
const SW_STRONG_V = 0.8; // å¼·ã„ã‚¹ãƒ¯ã‚¤ãƒ—ã®æœ€ä½é€Ÿåº¦(px/ms)
const SW_STRONG_X = 140; // å¼·ã„ã‚¹ãƒ¯ã‚¤ãƒ—ã®æœ€ä½è·é›¢(px)

function bindSwipe(track){
  const wrap = track.closest('.swipe-wrap');
  const actions = wrap.querySelector('.actions');
  const card = track.closest('.card');
  let sx=0, dx=0, active=false, lastT=0, lastX=0, velocity=0;

  const setX = (x)=>{ track.style.transform=`translateX(${x}px)`; actions.style.opacity=Math.min(1,Math.abs(x)/80); };

  const onStart = (x)=>{
    active=true; sx=x; dx=0; lastX=x; lastT=performance.now();
    track.style.transition='none';
    card.classList.add('showHint');
  };
  const onMove = (x)=>{
    if(!active) return;
    const now=performance.now();
    dx = x - sx;
    velocity = (x - lastX) / Math.max(1, (now - lastT)); // px/ms
    lastX=x; lastT=now;
    setX(dx);
  };
  const onEnd = async ()=>{
    card.classList.remove('showHint');
    track.style.transition='transform .18s ease';

    const absX = Math.abs(dx);
    const fast = (Math.abs(velocity) >= SW_STRONG_V) && (absX >= SW_STRONG_X);

    // å¼·ã„ã‚¹ãƒ¯ã‚¤ãƒ—ï¼šå³=å®Œäº† / å·¦=å‰Šé™¤ï¼ˆç¢ºèªã‚ã‚Šï¼‰
    if (fast){
      const id = card.dataset.id;
      if (dx > 0){
        try{ await runAction('complete',{ task_id:id }); toast('å®Œäº†ã—ã¾ã—ãŸ'); await loadTasks(); }catch{ toast('å¤±æ•—'); }
      }else{
        if (!confirm('ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')){ setX(0); dx=0; return; }
        try{ await runAction('delete',{ task_id:id }); toast('å‰Šé™¤ã—ã¾ã—ãŸ'); await loadTasks(); }catch{ toast('å¤±æ•—'); }
      }
      return;
    }

    // ã‚¹ãƒŠãƒƒãƒ—ï¼ˆãƒœã‚¿ãƒ³æ“ä½œã‚¿ã‚¤ãƒ ï¼‰
    if (dx > 0 && dx >= SW_SNAP_L){ setX(SW_SNAP_L); }
    else if (dx < 0 && dx <= SW_SNAP_R){ setX(SW_SNAP_R); }
    else { setX(0); dx=0; return; }

    // ãƒœã‚¿ãƒ³ã‚’æ´»æ€§åŒ–
    // ã“ã“ã§å„ãƒœã‚¿ãƒ³ã«ã‚¯ãƒªãƒƒã‚¯ã‚’ãƒã‚¤ãƒ³ãƒ‰ï¼ˆ1å›ã ã‘ï¼‰
    const btns = wrap.querySelectorAll('.btn');
    btns.forEach(b=>{
      if (b.dataset.binded) return;
      b.dataset.binded = '1';
      b.addEventListener('click', async (e)=>{
        const id = card.dataset.id;
        const act = e.currentTarget.dataset.act;
        try{
          if (act === 'detail'){
            // ã‚¿ã‚¤ãƒˆãƒ«è¡Œã‚’æ“¬ä¼¼ã‚¯ãƒªãƒƒã‚¯ï¼ä¸‹ã®ãƒ‘ãƒãƒ«é–‹ã
            card.querySelector('.titleRow').click();
            return;
          }
          if (act === 'delete'){
            if (!confirm('ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
          }
          if (act === 'pin'){
            // ç¾çŠ¶ãƒˆã‚°ãƒ«ï¼šãƒ‘ãƒãƒ«ã®ãƒã‚§ãƒƒã‚¯ã‚‚åˆã‚ã›ã‚‹
            const pan = el(`#p-${CSS.escape(id)}`);
            const ck = pan?.querySelector('[data-f="pinned"]');
            const newPin = !(ck?.checked);
            await runAction('pin', { task_id:id, pinned:newPin });
            toast(newPin?'ãƒ”ãƒ³ç•™ã‚ã—ã¾ã—ãŸ':'ãƒ”ãƒ³è§£é™¤ã—ã¾ã—ãŸ');
            await loadTasks();
            return;
          }
          // complete / remind ã¯æ—¢å­˜ã® action ã‚’è¸è¥²
          await runAction(act, { task_id:id });
          toast(act==='complete'?'å®Œäº†ã—ã¾ã—ãŸ':'å®Ÿè¡Œã—ã¾ã—ãŸ');
          await loadTasks();
        }catch(err){ console.error(err); toast('å¤±æ•—ã—ã¾ã—ãŸ'); }
      }, { once:false });
    });

    // å°‘ã—å¾…ã£ã¦è‡ªå‹•ã§æˆ»ã™ï¼ˆã‚¿ãƒƒãƒ—ã§ãã‚‹æ™‚é–“ã‚’ä¸ãˆã‚‹ï¼‰
    setTimeout(()=>{ track.style.transition='transform .18s ease'; setX(0); dx=0; }, 2000);
  };

  const startEv = (e)=> onStart(e.touches? e.touches[0].clientX : e.clientX);
  const moveEv  = (e)=> onMove(e.touches? e.touches[0].clientX : e.clientX);
  const endEv   = ()=> onEnd();

  track.addEventListener('touchstart', startEv, {passive:true});
  track.addEventListener('touchmove',  moveEv,  {passive:true});
  track.addEventListener('touchend',   endEv);
  track.addEventListener('mousedown',  startEv);
  track.addEventListener('mousemove',  (e)=>{ if(e.buttons===1) moveEv(e); });
  track.addEventListener('mouseup',    endEv);
}

/* ===== ãƒ‘ãƒãƒ«æ“ä½œ ===== */
function collectPanelFields(pan){
  const get = sel => pan.querySelector(sel);
  const getVal = (sel)=>{ const n=get(sel); return n? n.value : '' };
  const valOrNullNum = v => v===''? null : Number(v);
  const payload = {
    title: (getVal('[data-f="title"]')||'').trim(),
    detail:(getVal('[data-f="detail"]')||'').trim(),
    due_at: toUTCFromLocalInput(getVal('[data-f="due_at"]')),
    priority: valOrNullNum(getVal('[data-f="priority"]')),
    vision_score: valOrNullNum(getVal('[data-f="vision_score"]')),
    excite_score: valOrNullNum(getVal('[data-f="excite_score"]')),
    growth_score: valOrNullNum(getVal('[data-f="growth_score"]')),
    pinned: !!(pan.querySelector('[data-f="pinned"]')?.checked),
  };
  return payload;
}

async function saveCard(id, pan){
  try{
    const fields = collectPanelFields(pan);
    if (!fields.due_at){
      const t = gAllTasks.find(x=>x.id===id);
      if (t?.due_at) fields.due_at = t.due_at; // æœªå…¥åŠ›ãªã‚‰æ—¢å­˜ç¶­æŒ
    }
    await runAction('update', { task_id:id, fields });
    toast('ä¿å­˜ã—ã¾ã—ãŸ');
    await loadTasks();
    // å†åº¦ãƒ‘ãƒãƒ«é–‹ãï¼ˆä½ç½®ç¶­æŒï¼‰
    el(`#p-${CSS.escape(id)}`)?.classList.add('open');
  }catch(e){ console.error(e); toast('ä¿å­˜å¤±æ•—'); }
}
async function completeCard(id){
  try{ await runAction('complete',{task_id:id}); toast('å®Œäº†ã—ã¾ã—ãŸ'); await loadTasks(); }
  catch{ toast('å¤±æ•—'); }
}
async function uncompleteCard(id){
  try{ await runAction('uncomplete',{task_id:id}); toast('å–æ¶ˆã—ã¾ã—ãŸ'); await loadTasks(); }
  catch{ toast('å¤±æ•—'); }
}
async function togglePin(id, pan){
  try{
    const ck = pan.querySelector('[data-f="pinned"]');
    const newPin = !ck.checked;
    await runAction('pin',{ task_id:id, pinned:newPin });
    toast(newPin?'ãƒ”ãƒ³ç•™ã‚ã—ã¾ã—ãŸ':'ãƒ”ãƒ³è§£é™¤ã—ã¾ã—ãŸ');
    await loadTasks();
    el(`#p-${CSS.escape(id)}`)?.classList.add('open');
  }catch{ toast('å¤±æ•—'); }
}
async function deleteCard(id){
  if(!confirm('ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  try{ await runAction('delete',{task_id:id}); toast('å‰Šé™¤ã—ã¾ã—ãŸ'); await loadTasks(); }
  catch{ toast('å¤±æ•—'); }
}

/* ===== èµ·å‹• ===== */
async function bootstrap(){
  await liff.init({ liffId: LIFF_ID });
  if(!liff.isLoggedIn()) liff.login();
  const prof = await liff.getProfile();
  gUserId = prof.userId;
  el('#user-pill').textContent = 'You: ' + gUserId.slice(-6);
  await loadTasks();
}
bootstrap();
</script>
</body>
</html>
